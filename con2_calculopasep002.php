<?
/*
 *     E-cidade Software Publico para Gestao Municipal                
 *  Copyright (C) 2014  DBSeller Servicos de Informatica
 *                            www.dbseller.com.br
 *                         e-cidade@dbseller.com.br
 *
 *  Este programa e software livre; voce pode redistribui-lo e/ou
 *  modifica-lo sob os termos da Licenca Publica Geral GNU, conforme
 *  publicada pela Free Software Foundation; tanto a versao 2 da
 *  Licenca como (a seu criterio) qualquer versao mais nova.
 *
 *  Este programa e distribuido na expectativa de ser util, mas SEM
 *  QUALQUER GARANTIA; sem mesmo a garantia implicita de
 *  COMERCIALIZACAO ou de ADEQUACAO A QUALQUER PROPOSITO EM
 *  PARTICULAR. Consulte a Licenca Publica Geral GNU para obter mais
 *  detalhes.
 *
 *  Voce deve ter recebido uma copia da Licenca Publica Geral GNU
 *  junto com este programa; se nao, escreva para a Free Software
 *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
 *  02111-1307, USA.
 *
 *  Copia da licenca no diretorio licenca/licenca_en.txt
 *                                licenca/licenca_pt.txt
 */

require_once "libs/db_stdlib.php";
require_once "libs/db_conecta.php";
include_once "libs/db_sessoes.php";
include_once "libs/db_usuariosonline.php";
include("vendor/mpdf/mpdf/mpdf.php");
include("libs/db_liborcamento.php");
include("libs/db_libcontabilidade.php");
include("libs/db_sql.php");

db_postmemory($HTTP_POST_VARS);
$oPeriodo = new Periodo($o116_periodo);
$aDecendios = DBDate::getDecendio($oPeriodo->getMesInicial(),$anousu);
$aDecendios[0][2] = "Depositar até o dia 20";
$aDecendios[1][2] = "Depositar até o dia 30";
$aDecendios[2][2] = "Depositar até o dia 10 do mês subsequente";

$instits = str_replace('-', ', ', $db_selinstit);
$aInstits = explode(",",$instits);
if(count($aInstits) > 1){
  $oInstit = new Instituicao(db_getsession("db_instit"));
} else {
  foreach ($aInstits as $iInstit) {
    $oInstit = new Instituicao($iInstit);
  }
}

/**
 * mPDF
 * @param string $mode              | padrão: BLANK
 * @param mixed $format             | padrão: A4
 * @param float $default_font_size  | padrão: 0
 * @param string $default_font      | padrão: ''
 * @param float $margin_left        | padrão: 15
 * @param float $margin_right       | padrão: 15
 * @param float $margin_top         | padrão: 16
 * @param float $margin_bottom      | padrão: 16
 * @param float $margin_header      | padrão: 9
 * @param float $margin_footer      | padrão: 9
 *
 * Nenhum dos parâmetros é obrigatório
 */

$mPDF = new mpdf('', 'A4-L', 0, '', 10, 10, 20, 15, 8, 11);


$header = <<<HEADER
<header>
  <table style="width:100%;text-align:center;font-family:sans-serif;padding-bottom:6px;">
    <tr>
      <td>{$oInstit->getDescricao()}</td>
    </tr>
    <tr>
      <th>"CÁLCULO PARA CONTRIBUIÇÃO DO PASEP"</th>
    </tr>
  </table>
</header>
HEADER;

$footer = <<<FOOTER
<div style='border-top:1px solid #000;width:100%;text-align:right;font-family:sans-serif;font-size:10px;height:10px;'>
  {PAGENO}
</div>
FOOTER;


$mPDF->WriteHTML(file_get_contents('estilos/tab_relatorio.css'), 1);
$mPDF->setHTMLHeader(utf8_encode($header), 'O', true);
$mPDF->setHTMLFooter(utf8_encode($footer), 'O', true);

ob_start();

?>
  
  <html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <style type="text/css">
      .ritz .waffle a { color : inherit; }
      .ritz .waffle .s3 { background-color : #ffffff; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; padding : 2px 3px 2px 3px; text-align : left; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s4 { background-color : #ffffff; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Calibri',Arial; font-size : 10pt; padding : 2px 3px 2px 3px; text-align : right; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s6 { background-color : #d8d8d8; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : center; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s1 { background-color : #ffffff; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : left; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s9 { background-color : #d8d8d8; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : left; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s10 { background-color : #d8d8d8; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : right; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s8 { background-color : #bfbfbf; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : right; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s7 { background-color : #bfbfbf; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : left; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s5 { background-color : #ffffff; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; padding : 2px 3px 2px 3px; text-align : right; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s0 { background-color : #bfbfbf; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : center; vertical-align : bottom; white-space : nowrap; }
      .ritz .waffle .s2 { background-color : #ffffff; border-bottom : 1px SOLID #000000; border-right : 1px SOLID #000000; color : #000000; direction : ltr; font-family : 'Arial'; font-size : 11pt; font-weight : bold; padding : 2px 3px 2px 3px; text-align : center; vertical-align : bottom; white-space : nowrap; }
    </style>
  
  </head>
  <body>


  <div class="ritz grid-container" dir="ltr">
    <table class="waffle" cellspacing="0" cellpadding="0">
      <tbody>
      <tr style=''>
        <td class="s0 bdtop bdleft" colspan="2">CÁLCULO PARA CONTRIBUIÇÃO DO PASEP</td>
      </tr>
      <tr style=''>
        <td class="s0 bdleft" colspan="2">I - RECEITAS</td>
      </tr>
      <tr style=''>
        <td class="s0 bdleft" colspan="2">Inc. III, do art. 2º, da Lei n.º 9.715/98</td>
      </tr>
      <tr style=''>
        <td class="s1 bdleft" style="width:700px">Receitas Correntes (Líquida de deduções)</td>
        <td class="s2" style="width:172px">VALOR</td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1100.00.00.00 - Receitas Tributárias ?</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1200.00.00.00 - Receita de Contribuições -</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1300.00.00.00 - Receita Patrimonial -</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1400.00.00.00 - Receita Agropecuária -</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1500.00.00.00 - Receita Industrial -</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1600.00.00.00 - Receita de Serviços -</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1700.00.00.00 - Transferências Correntes ?</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">1900.00.00.00 - Outras receitas correntes -</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s1 bdleft">Sub-Total I -</td>
        <td class="s5">0,00</td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">2400.00.00.00 - Transferências de Capital</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s1 bdleft">Sub-Total II -</td>
        <td class="s5">0,00</td>
      </tr>
      <tr style=''>
        <td class="s1 bdleft">Total das Receitas (I) -</td>
        <td class="s5">0,00</td>
      </tr>
      <tr style=''>
        <td class="s0 bdleft" colspan="2">II - EXCLUSÕES DA RECEITA</td>
      </tr>
      <tr style=''>
        <td class="s6 bdleft">Base Legal </td>
        <td class="s6">VALOR</td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">Transferências de Convênios (§ 7º, do art. 2º, da Lei n.º 9.715/98) -</td>
        <td class="s4"></td>
      </tr>
      <tr>
        <td class="s3 bdleft" dir="ltr">
          Contrato de repasse ou instrumento congênere com objeto definido (§ 7º, do art. 2º, da Lei n.º
          <br/> 9.715/98)
        </td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">Transferências a outras Entidades de Direito Público Interno (art. 7º, da Lei n.º 9.715/98) -</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft" dir="ltr">
          Transferências efetuadas à União, aos Estados, ao Distrito Federal e a outros Municípios, bem
          <br>como às autarquias dessas entidades (Solução de Consulta RFB n.º 31, de 28 de fevereiro de
          <br>2013 - 6ª Região Fiscal - D.O.U.: 05.03.2013)
        </td>
        <td class="s3" dir="ltr"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft" dir="ltr">
          Transferências efetuadas à Instituições Multigovernamentais Nacionais (criadas e mantidas por
          <br>dois ou mais entes da Federação) de caráter público, criadas por lei. (Solução de Consulta RFB
          <br>n.º 31, de 28 de fevereiro de 2013 - 6ª Região Fiscal - D.O.U.: 05.03.2013)
        </td>
        <td class="s3" dir="ltr"></td>
      </tr>
      <tr style=''>
        <td class="s1 bdleft">Total das exclusões da Receita (II) -</td>
        <td class="s5">0,00 </td>
      </tr>
      <tr style=''>
        <td class="s7 bdleft">III - TOTAL RECEITA LÍQUIDA (BASE DE CÁLCULO) (I-II) -</td>
        <td class="s8">0,00</td>
      </tr>
      <tr style=''>
        <td class="s9 bdleft">IV ? RETENÇÕES DO PASEP NA FONTE</td>
        <td class="s6">VALOR</td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">FPM - Fundo de Participação dos Municípios</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">F.E.P. - Fundo Especial Petróleo</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">ICMS - Desoneração das Exportações - LC n.º 87/96</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">ITR - Imposto Territorial Rural</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">CFM - Depto Nacional de Produção Mineral</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">CIDE ? Contribuições de Intervenção no Domínio Econômico</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">CFH - Cota parte Compensação Finan. Rec. Hídricos</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">FEX - Auxílio Financeiro para Fomento Exportações / AFM - Apoio Financeiro aos Municípios</td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft" dir="ltr">
          Outras transferências correntes e de capital recebidas, se comprovada a retenção na fonte, pela
          <br>Secretaria do Tesouro Nacional - STN, da contribuição incidente sobre tais valores.
        </td>
        <td class="s4"></td>
      </tr>
      <tr style=''>
        <td class="s1 bdleft">TOTAL DOS VALORES RETIDOS (IV) -</td>
        <td class="s5">0,00 </td>
      </tr>
      <tr style=''>
        <td class="s6 bdleft">RESUMO</td>
        <td class="s10">0,00 </td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">a) Total da Receita Líquida (III) -</td>
        <td class="s5">0,00 </td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">b) 1% sobre total das Receitas (a*1%) -</td>
        <td class="s5">0,00</td>
      </tr>
      <tr style=''>
        <td class="s3 bdleft">c) PASEP retido na Fonte (IV) -</td>
        <td class="s5">0,00 </td>
      </tr>
      <tr style=''>
        <td class="s7 bdleft">RESULTADO DO CÁLCULO (b-c)</td>
        <td class="s8">0,00 </td>
      </tr>
      </tbody>
    </table>
  </div>
  
  </body>
  </html>

<?php

$html = ob_get_contents();
ob_end_clean();
$mPDF->WriteHTML(utf8_encode($html));
$mPDF->Output();
//echo $html;

?>